var Se=Object.defineProperty;var we=(e,t)=>{for(var s in t)Se(e,s,{get:t[s],enumerable:!0})};import"dotenv/config";import{z as J}from"zod";var be=J.object({NODE_ENV:J.enum(["dev","prod"]).default("prod"),DATABASE_URL:J.string(),DATABASE_AUTH_TOKEN:J.string().optional()}),Ie=be.parse(process.env),C=Ie;import{serve as St}from"@hono/node-server";import{Hono as wt}from"hono";import{openAPIRouteHandler as bt}from"hono-openapi";import{compress as It}from"hono/compress";var a={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"IM Used":226,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Use Proxy":305,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Entity":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511};import ge from"argon2";import{HTTPException as mt}from"hono/http-exception";import{drizzle as ct}from"drizzle-orm/libsql";var ae={};we(ae,{BusinessSchema:()=>Xe,accountSchema:()=>N,accounts:()=>h,accountsRelations:()=>nt,businessAddresses:()=>E,businessListingAddressRelations:()=>_e,businessListingRelations:()=>Fe,businessListings:()=>p,businesses:()=>r,businessesRelations:()=>Je,employees:()=>T,employeesRelations:()=>Ze,orderSchema:()=>Ee,orders:()=>c,ordersRelations:()=>He,reviews:()=>A,reviewsRelations:()=>je,sessionSchema:()=>f,sessions:()=>m,sessionsRelations:()=>Ue,userAddressSchema:()=>w,userAddresses:()=>n,userAddressesRelations:()=>Oe,userSchema:()=>B,users:()=>o,usersRelations:()=>st,views:()=>Z,viewsRelations:()=>ut});import{relations as ot}from"drizzle-orm";import{integer as ye,sqliteTable as rt,text as he}from"drizzle-orm/sqlite-core";import V from"zod";import{relations as ve}from"drizzle-orm";import{int as xe,sqliteTable as Ne,text as Q}from"drizzle-orm/sqlite-core";import z from"zod";var m=Ne("sessions",{token:Q("token").primaryKey(),userAgent:Q("user_agent").notNull(),ipAddress:Q("ip_address").notNull(),accountId:Q("account_id").references(()=>h.id,{onDelete:"cascade"}).notNull(),createdAt:xe("created_at",{mode:"timestamp"}).notNull().$default(()=>new Date)}),Ue=ve(m,({one:e})=>({account:e(h,{fields:[m.accountId],references:[h.id]})})),f=z.object({token:z.base64(),userAgent:z.string(),ipAddress:z.ipv4(),accountId:z.uuid(),createdAt:z.iso.datetime()});import{relations as et}from"drizzle-orm";import{sqliteTable as tt,text as X}from"drizzle-orm/sqlite-core";import M from"zod";import{relations as Ye}from"drizzle-orm";import{integer as ie,sqliteTable as Ge,text as D}from"drizzle-orm/sqlite-core";import d from"zod";import{relations as ke}from"drizzle-orm";import{real as L,sqliteTable as Re,text as H}from"drizzle-orm/sqlite-core";var E=Re("business_addresses",{businessId:H("business_id").primaryKey().references(()=>r.id,{onDelete:"cascade"}).notNull(),completeAddress:H("complete_address").notNull(),city:H("city").notNull(),state:H("state").notNull(),pincode:H("pincode").notNull(),latitude:L("latitude").notNull(),longitude:L("longitude").notNull(),minLatitude:L("min_latitude").notNull(),maxLatitude:L("max_latitude").notNull(),minLongitude:L("min_longitude").notNull(),maxLongitude:L("max_longitude").notNull()}),_e=ke(E,({one:e,many:t})=>({business:e(r,{fields:[E.businessId],references:[r.id]})}));import{relations as Me}from"drizzle-orm";import{integer as Be,sqliteTable as Ve,text as W}from"drizzle-orm/sqlite-core";import{relations as $e}from"drizzle-orm";import{integer as ne,sqliteTable as Ce,text as b}from"drizzle-orm/sqlite-core";import{relations as De}from"drizzle-orm";import{integer as re,sqliteTable as Ke,text as S}from"drizzle-orm/sqlite-core";import{relations as Pe}from"drizzle-orm";import{integer as me,sqliteTable as qe,text as q}from"drizzle-orm/sqlite-core";var A=qe("reviews",{id:q("id").primaryKey().$default(()=>crypto.randomUUID()),rating:me("rating").$type().notNull(),title:q("title").notNull(),comment:q("comment").notNull(),userId:q("user_id").references(()=>o.id,{onDelete:"cascade"}).notNull(),businessId:q("business_id").references(()=>r.id,{onDelete:"cascade"}).notNull(),listingId:q("listing_id").references(()=>p.id,{onDelete:"cascade"}).notNull(),media:q("media",{mode:"json"}).$type(),createdAt:me("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),je=Pe(A,({one:e,many:t})=>({user:e(o,{fields:[A.userId],references:[o.id]}),business:e(r,{fields:[A.userId],references:[r.id]}),listing:e(p,{fields:[A.listingId],references:[p.id]})}));var p=Ke("business_listings",{id:S("id").primaryKey().$default(()=>crypto.randomUUID()),businessId:S("business_id").notNull().references(()=>r.id,{onDelete:"cascade"}),title:S("title").notNull(),description:S("description"),productSpecs:S("product_specs",{mode:"json"}).$type(),logo:S("logo"),price:S("price").notNull(),categories:S("categories",{mode:"json"}).$type().notNull(),tags:S("tags",{mode:"json"}).$type().notNull(),type:S("type",{enum:["product","service"]}).notNull(),media:S("media",{mode:"json"}).$type(),stock:re("stock"),available:re("available",{mode:"boolean"}),createdAt:re("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),Fe=De(p,({one:e,many:t})=>({business:e(r,{fields:[p.businessId],references:[r.id]}),orders:t(c),reviews:t(A)}));import{relations as ze}from"drizzle-orm";import{real as fe,sqliteTable as Le,text as j}from"drizzle-orm/sqlite-core";import g from"zod";var n=Le("user_addresses",{id:j("id").primaryKey().$default(()=>crypto.randomUUID()),name:j("name").notNull(),userId:j("user_id").references(()=>o.id,{onDelete:"cascade"}).notNull(),completeAddress:j("complete_address").notNull(),city:j("city").notNull(),state:j("state").notNull(),pincode:j("pincode").notNull(),latitude:fe("latitude"),longitude:fe("longitude")}),Oe=ze(n,({one:e,many:t})=>({user:e(o,{fields:[n.userId],references:[o.id]}),orders:t(c)})),w=g.object({id:g.uuid(),name:g.string(),userId:g.uuid(),addressLine1:g.string(),addressLine2:g.string().nullable(),landmark:g.string().nullable(),city:g.string(),state:g.string(),pincode:g.string(),latitude:g.number().nullable(),longitude:g.number().nullable()});import l from"zod";var c=Ce("orders",{id:b("id").primaryKey().$default(()=>crypto.randomUUID()),customerPhone:ne("customer_phone").notNull(),status:b("status",{enum:["placed","confirmed","preparing","out_for_delivery","in_progress","completed","cancelled"]}).notNull().default("placed"),cancellationReason:b("cancellation_reason"),quantity:ne("quantity").notNull().default(1),estimatedArrivalTime:b("estimated_arrival_time").$type(),customerNotes:b("customer_notes"),shopNotes:b("shop_notes"),customerId:b("customer_id").notNull().references(()=>o.id,{onDelete:"cascade"}),addressId:b("address_id").notNull().references(()=>n.id,{onDelete:"cascade"}),businessId:b("business_id").notNull().references(()=>r.id,{onDelete:"cascade"}),listingId:b("listing_id").notNull().references(()=>p.id,{onDelete:"cascade"}),deliveryEmployeeId:b("delivery_employee_id").notNull().references(()=>T.id,{onDelete:"cascade"}),createdAt:ne("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),He=$e(c,({one:e,many:t})=>({customer:e(o,{fields:[c.customerId],references:[o.id]}),address:e(n,{fields:[c.addressId],references:[n.id]}),business:e(r,{fields:[c.businessId],references:[r.id]}),listing:e(p,{fields:[c.listingId],references:[p.id]}),deliveryEmployee:e(T,{fields:[c.deliveryEmployeeId],references:[T.id]})})),Ee=l.object({id:l.uuid(),customerPhone:l.number(),status:l.enum(["placed","confirmed","preparing","out_for_delivery","in_progress","completed","cancelled"]).default("placed"),cancellationReason:l.string().nullable(),quantity:l.number(),estimatedArrivalTime:l.string().nullable(),customerNotes:l.string().nullable(),shopNotes:l.string().nullable(),customerId:l.uuid(),addressId:l.uuid(),businessId:l.uuid(),listingId:l.uuid(),deliveryEmployeeId:l.uuid(),createdAt:l.iso.datetime()});var T=Ve("employees",{id:W("id").primaryKey().$default(()=>crypto.randomUUID()),role:W("role",{enum:["manager","staff"]}).default("staff"),userId:W("user_id").references(()=>o.id,{onDelete:"cascade"}).notNull(),businessId:W("business_id").references(()=>r.id,{onDelete:"cascade"}).notNull(),createdAt:Be("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),Ze=Me(T,({one:e,many:t})=>({user:e(o,{fields:[T.userId],references:[o.id]}),business:e(r,{fields:[T.businessId],references:[r.id]}),orders:t(c)}));var r=Ge("businesses",{id:D("id").primaryKey().$default(()=>crypto.randomUUID()),ownerId:D("owner_id").notNull().references(()=>o.id,{onDelete:"cascade"}),phoneNumber:ie("phone_number").notNull(),businessHours:D("business_hours",{mode:"json"}).$type().notNull(),media:D("media",{mode:"json"}).$type(),isClosed:ie("is_closed",{mode:"boolean"}).notNull().default(!1),title:D("title").notNull(),logo:D("logo"),description:D("description"),createdAt:ie("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),Je=Ye(r,({one:e,many:t})=>({owner:e(o,{fields:[r.ownerId],references:[o.id]}),address:e(E),employees:t(T),orders:t(c),reviews:t(A)})),Qe=d.record(d.enum(["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]),d.union([d.literal("closed"),d.literal("24 hours"),d.string().regex(/^\d+:\d+-\d+:\d+$/)])),We=d.object({type:d.enum(["image","video"]),url:d.url()}),Xe=d.object({id:d.uuid(),ownerId:d.uuid(),phoneNumber:d.number().min(1e9,"phone is not valid").max(9999999999,"phone is not valid"),businessHours:Qe,media:d.array(We).optional(),isClosed:d.boolean(),title:d.string().min(2).max(50),logo:d.url().optional(),description:d.string().optional(),createdAt:d.iso.datetime()});var o=tt("users",{id:X("id").primaryKey().$default(()=>crypto.randomUUID()),name:X("name").notNull(),avatar:X("avatar"),accountId:X("account_id").unique().references(()=>h.id,{onDelete:"cascade"}).notNull()}),st=et(o,({one:e,many:t})=>({account:e(h,{fields:[o.accountId],references:[h.id]}),employeesProfiles:t(T),businesses:t(r),addresses:t(n),orders:t(c),reviews:t(A)})),B=M.object({id:M.uuid(),name:M.string().min(2),avatar:M.url().optional().nullable(),accountId:M.uuid()});var h=rt("accounts",{id:he("id").primaryKey().$default(()=>crypto.randomUUID()),phone:ye("phone").notNull().unique(),password:he("password").notNull(),createdAt:ye("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),nt=ot(h,({many:e,one:t})=>({sessions:e(m),user:t(o)})),N=V.object({id:V.uuid(),phone:V.number().min(1e9,"phone is not valid").max(9999999999,"phone is not valid"),password:V.string().min(6).max(128),createdAt:V.iso.datetime()});import{relations as it}from"drizzle-orm";import{integer as at,sqliteTable as dt,text as ee}from"drizzle-orm/sqlite-core";var Z=dt("views",{id:ee("id").primaryKey().$default(()=>crypto.randomUUID()),userId:ee("user_id").references(()=>o.id,{onDelete:"cascade"}).notNull(),businessId:ee("business_id").references(()=>r.id,{onDelete:"cascade"}).notNull(),listingId:ee("listing_id").references(()=>p.id,{onDelete:"cascade"}).notNull(),createdAt:at("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),ut=it(Z,({one:e,many:t})=>({user:e(o,{fields:[Z.userId],references:[o.id]}),business:e(r,{fields:[Z.userId],references:[r.id]}),listing:e(p,{fields:[Z.listingId],references:[p.id]})}));var pt=ct({connection:{url:C.DATABASE_URL,authToken:C.DATABASE_AUTH_TOKEN},schema:ae}),u=pt;import{and as lt,eq as ue}from"drizzle-orm";function de(e=128){let t=crypto.getRandomValues(new Uint8Array(e));return btoa(String.fromCharCode(...t))}var U={async findAccountByPhone(e){return await u.query.accounts.findFirst({where:(s,{eq:i})=>i(s.phone,e.phone)})},async findAccount(e){return(await u.query.sessions.findFirst({where:(s,{eq:i})=>i(s.token,e.token),columns:{},with:{account:{columns:{password:!1}}}}))?.account},async findUser(e){return(await u.query.sessions.findFirst({where:(s,{eq:i})=>i(s.token,e.token),columns:{},with:{account:{columns:{},with:{user:{columns:{accountId:!1}}}}}}))?.account.user??void 0},async createAccount(e){let t=crypto.randomUUID(),s=de();return await u.batch([u.insert(h).values({id:t,phone:e.phone,password:e.password}),u.insert(m).values({accountId:t,ipAddress:"127.0.0.1",token:s,userAgent:"no agent"})]),{token:s}},async createSession(e){let t=de();return await u.insert(m).values({accountId:e.accountId,ipAddress:e.ipAddress,token:t,userAgent:e.userAgent}),{token:t}},async createUser(e){let[t]=await u.insert(o).values(e).returning({id:o.id,name:o.name,avatar:o.avatar});return t},async findAllSessions(e){return await u.query.sessions.findMany({where:(s,{eq:i})=>i(s.accountId,e.accountId),columns:{accountId:!1}})},async deleteSession(e){await u.delete(m).where(lt(ue(m.accountId,e.accountId),ue(m.token,e.token)))},async logout(e){await u.delete(m).where(ue(m.token,e.token))}};var I={async findAccountByPhone(e){return await U.findAccountByPhone(e)},async findAccount(e){return await U.findAccount(e)},async findUser(e){return await U.findUser(e)},async login(e){let t=await this.findAccountByPhone({phone:e.phone});if(t){if(!await ge.verify(t.password,e.password))throw new mt(a.Unauthorized,{message:"Your password was incorrect"});return await U.createSession({accountId:t.id,ipAddress:e.ipAddress,userAgent:e.userAgent})}let s=await ge.hash(e.password);return await U.createAccount({...e,password:s})},async createUser(e){return await U.createUser(e)},async findAllSessions(e){return await U.findAllSessions(e)},async deleteSession(e){await U.deleteSession(e)},async logout(e){await U.logout(e)}};import{createMiddleware as Te}from"hono/factory";import{HTTPException as Y}from"hono/http-exception";var k=({type:e})=>Te(async(t,s)=>{let i=t.req.header("Authorization");if(!i)throw new Y(a.Unauthorized,{message:"Please sign-in/sign-up to use this api route"});if(e==="account"){let x=await I.findAccount({token:i});if(!x)throw new Y(a.Unauthorized,{message:"Your account does not exit"});t.set("account",x)}if(e==="user"){let x=await I.findUser({token:i});if(!x)throw new Y(a.Unauthorized,{message:"Your user does not exit"});t.set("user",x)}t.set("sessionToken",i),await s()}),ce=({type:e})=>Te(async(t,s)=>{let i=t.req.header("Authorization");if(!i){await s();return}if(e==="account"&&await I.findAccount({token:i}))throw new Y(a.Unauthorized,{message:"You already have an account"});if(e==="user"&&await I.findUser({token:i}))throw new Y(a.Unauthorized,{message:"Your already have a user"});await s()});import{resolver as ft}from"hono-openapi";import"zod";var y=e=>Object.fromEntries(Object.entries(e).map(([t,s])=>[a[t],{description:t,content:{"application/json":{schema:ft(s)}}}]));import{sValidator as se}from"@hono/standard-validator";import{Hono as ht}from"hono";import{describeRoute as oe}from"hono-openapi";import{z as pe}from"zod";var yt={repository(){return{create:{input:w.omit({id:!0}),output:w.omit({userId:!0})},find:{input:w.pick({id:!0,userId:!0}),output:w.omit({userId:!0}).optional()},update:{input:w.partial().required({userId:!0,id:!0}),output:w.omit({userId:!0})},delete:{input:w.pick({id:!0,userId:!0})},findAll:{input:w.pick({userId:!0}),output:pe.array(w.omit({userId:!0}))}}},service(){return{create:this.repository().create,find:this.repository().find,update:this.repository().update,delete:this.repository().delete,findAll:this.repository().findAll}},route(){return{create:{request:{json:this.service().create.input.omit({userId:!0})},response:{Created:this.service().create.output}},find:{request:{param:this.service().find.input.pick({id:!0})},response:{OK:this.service().find.output}},update:{request:{param:this.service().update.input.pick({id:!0}),json:this.service().update.input.omit({userId:!0,id:!0})},response:{OK:this.service().update.output}},delete:{request:{param:this.service().delete.input.pick({id:!0})},response:{OK:pe.object({success:pe.boolean().default(!0)})}},findAll:{response:{OK:this.service().findAll.output}}}}},R=yt.route();import{and as Ae,eq as te}from"drizzle-orm";var O={async find(e){return await u.query.userAddresses.findFirst({where:(s,{eq:i,and:x})=>x(i(s.id,e.id),i(s.userId,e.userId)),columns:{userId:!1}})},async findAll(e){return await u.query.userAddresses.findMany({where:(s,{eq:i})=>i(s.userId,e.userId),columns:{userId:!1}})},async create(e){let[t]=await u.insert(n).values(e).returning({id:n.id,name:n.name,addressLine1:n.addressLine1,addressLine2:n.addressLine2,landmark:n.landmark,city:n.city,state:n.state,pincode:n.pincode,latitude:n.latitude,longitude:n.longitude});return t},async update({userId:e,id:t,...s}){let[i]=await u.update(n).set(s).where(Ae(te(n.id,t),te(n.userId,e))).returning();return i},async delete(e){await u.delete(n).where(Ae(te(n.id,e.id),te(n.userId,e.userId)))}};var G={async findAll(e){return await O.findAll(e)},async find(e){return await O.find(e)},async create(e){return await O.create(e)},async update(e){return await O.update(e)},async delete(e){await O.delete(e)}};var $=new ht().use(k({type:"user"}));$.get("/",oe({description:"Find All Addresses",responses:y(R.findAll.response)}),async e=>{let t=await G.findAll({userId:e.get("user").id});return e.json(t)});$.post("/",oe({description:"Create Addresses",responses:y(R.create.response)}),se("json",R.create.request.json),async e=>{let t=e.req.valid("json"),s=await G.create({...t,userId:e.get("user").id});return e.json(s)});$.get("/:id",oe({description:"Find Address",responses:y(R.find.response)}),se("param",R.find.request.param),async e=>{let{id:t}=e.req.valid("param"),s=await G.find({id:t,userId:e.get("user").id});return e.json(s)});$.patch("/:id",oe({description:"Update Address",responses:y(R.update.response)}),se("param",R.update.request.param),se("json",R.update.request.json),async e=>{let{id:t}=e.req.valid("param"),s=e.req.valid("json"),i=await G.update({...s,id:t,userId:e.get("user").id});return e.json(i)});import{Hono as Tt}from"hono";import{describeRoute as K,validator as le}from"hono-openapi";import{HTTPException as At}from"hono/http-exception";import{z as _}from"zod";var gt={repository(){return{createAccount:{input:_.object({password:N.shape.password,phone:N.shape.phone,ipAddress:f.shape.ipAddress,userAgent:f.shape.userAgent}),output:f.pick({token:!0})},createSession:{input:_.object({ipAddress:f.shape.ipAddress,userAgent:f.shape.userAgent,accountId:N.shape.id}),output:f.pick({token:!0})},findAccount:{input:f.pick({token:!0}),output:N.omit({password:!0}).optional()},findAccountByPhone:{input:N.pick({phone:!0}),output:N.optional()},findUser:{input:f.pick({token:!0}),output:B.omit({accountId:!0}).optional()},createUser:{input:B.omit({id:!0}),output:B.omit({accountId:!0})},findAllSessions:{input:_.object({accountId:N.shape.id}),output:_.array(f.omit({accountId:!0}))},deleteSession:{input:_.object({accountId:N.shape.id,token:f.shape.token})},logout:{input:f.pick({token:!0})}}},service(){return{login:this.repository().createAccount,findAccount:this.repository().findAccount,findAccountByPhone:this.repository().findAccountByPhone,findUser:this.repository().findUser,createUser:this.repository().createUser,findAllSessions:this.repository().findAllSessions,deleteSession:this.repository().deleteSession,logout:this.repository().logout}},route(){return{login:{request:{json:this.service().login.input.pick({phone:!0,password:!0})},response:{OK:this.service().login.output}},findAccount:{response:{OK:this.service().findAccount.output}},findUser:{response:{OK:this.service().findUser.output}},createUser:{request:{json:this.service().createUser.input.omit({accountId:!0})},response:{Created:this.service().createUser.output}},findAllSessions:{response:{OK:this.service().findAllSessions.output}},deleteSession:{request:{json:this.service().deleteSession.input.pick({token:!0})},response:{OK:_.object({success:_.boolean().default(!0)})}},logout:{response:{OK:_.object({success:_.boolean().default(!0)})}}}}},v=gt.route();var P=new Tt;P.post("/login",K({description:"Login",responses:y(v.login.response)}),le("json",v.login.request.json),ce({type:"account"}),async e=>{let t=e.req.valid("json"),s=await I.login({...t,ipAddress:"127.0.0.1",userAgent:"no useragent"});return e.json(s,a.OK)});P.post("/user",K({description:"Create User",responses:y(v.createUser.response)}),le("json",v.createUser.request.json),ce({type:"user"}),k({type:"account"}),async e=>{let t=e.req.valid("json"),s=await I.createUser({...t,accountId:e.get("account").id});return e.json(s,a.Created)});P.get("/user",K({description:"Find User",responses:y(v.findUser.response)}),k({type:"user"}),async e=>e.json(e.get("user"),a.OK));P.get("/account",K({description:"Find Account",responses:y(v.findAccount.response)}),k({type:"account"}),async e=>e.json(e.get("account"),a.OK));P.get("/sessions",K({description:"Find All Sessions",responses:y(v.findAllSessions.response)}),k({type:"account"}),async e=>{let t=await I.findAllSessions({accountId:e.get("account").id});return e.json(t,a.OK)});P.delete("/session",K({description:"Delete Session",responses:y(v.deleteSession.response)}),le("json",v.deleteSession.request.json),k({type:"account"}),async e=>{let t=e.req.valid("json").token;if(t===e.get("sessionToken"))throw new At(a.Forbidden,{message:"You cannot delete your current session"});return await I.deleteSession({token:t,accountId:e.get("account").id}),e.json({success:!0},a.OK)});P.get("/logout",K({description:"Logout",responses:y(v.logout.response)}),k({type:"account"}),async e=>(await I.logout({token:e.get("sessionToken")}),e.json({success:!0},a.OK)));var F=new wt;F.use(It());F.route("/auth",P);F.route("/address",$);F.get("/openapi",bt(F,{documentation:{info:{title:"Theeka API",version:"0.0.1",description:"Theeka API"},servers:[{url:"http://localhost:3000",description:"Local Server"}]}}));C.NODE_ENV==="dev"&&St({fetch:F.fetch,port:3e3},e=>{console.log(`Server is running on http://localhost:${e.port}`)});var gr=F;export{gr as default};
